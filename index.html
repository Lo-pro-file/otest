<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Smart Video Player</title>
<style>
  :root{
    --bg1:#0f172a; --bg2:#1e293b; --card:#111827; --muted:#9ca3af;
    --accent:#2563eb; --success:#16a34a; --error:#ef4444;
    --glass: rgba(255,255,255,0.05);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    font-family:"Poppins",Inter,system-ui,Segoe UI,Roboto;
    background:linear-gradient(145deg,var(--bg1),var(--bg2));
    color:#f1f5f9;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:36px;
  }
  .wrap{
    width:100%;
    max-width:880px;
    background:var(--glass);
    border-radius:20px;
    padding:30px;
    backdrop-filter:blur(20px);
    box-shadow:0 10px 40px rgba(0,0,0,0.4);
    border:1px solid rgba(255,255,255,0.08);
    animation:fadeIn 0.8s ease;
  }
  @keyframes fadeIn {
    from{opacity:0;transform:translateY(15px)}
    to{opacity:1;transform:translateY(0)}
  }
  h1{margin:0;font-size:24px;font-weight:600;color:#fff}
  p.lead{margin:4px 0 20px;color:var(--muted)}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  input[type="text"]{
    flex:1;
    background:var(--card);
    border:1px solid rgba(255,255,255,0.08);
    padding:12px 14px;
    border-radius:10px;
    color:#e6eef8;
    outline:none;
    font-size:15px;
  }
  button.primary{
    background:var(--accent);
    color:white;
    border:none;
    padding:12px 18px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
    transition:0.2s;
  }
  button.primary:hover{background:#1d4ed8;transform:scale(1.04)}
  .video-wrap{margin-top:24px;display:none;flex-direction:column;gap:14px}
  .player{
    background:var(--card);
    border-radius:14px;
    padding:14px;
    box-shadow:inset 0 0 20px rgba(255,255,255,0.03);
  }
  video{
    width:100%;
    border-radius:12px;
    background:#000;
  }
  .actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
  .btn{
    padding:9px 14px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:600;
    transition:0.2s;
  }
  .btn.download{background:var(--success);color:white;}
  .btn.copy{background:#7c3aed;color:white;}
  .btn:hover{opacity:0.9;transform:scale(1.03)}
  .info{color:var(--muted);font-size:14px;margin-top:6px}
  .loading{margin-top:10px;color:var(--muted);font-size:14px}
  .error{
    margin-top:14px;
    color:#fff;
    background:rgba(239,68,68,0.15);
    border:1px solid var(--error);
    padding:10px;
    border-radius:10px;
  }
  @media (max-width:720px){
    .row{flex-direction:column}
    button.primary{width:100%}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>üé¨ Smart Video Player</h1>
    <p class="lead">Paste your <b>video page URL</b> below and play instantly!</p>

    <div class="row">
      <input id="pageUrl" placeholder="Example: https://linkdebhai.club/video/..." />
      <button id="goBtn" class="primary">Get & Play ‚ñ∂Ô∏è</button>
    </div>

    <div id="status" class="loading" aria-live="polite"></div>
    <div id="errorBox" class="error" style="display:none"></div>

    <div class="video-wrap" id="videoWrap">
      <div class="player">
        <div id="meta">
          <div id="title" style="font-weight:700;font-size:18px;margin-bottom:4px"></div>
          <div id="source" class="info"></div>
        </div>

        <video id="player" controls preload="metadata" playsinline></video>

        <div class="actions">
          <a id="downloadBtn" class="btn download" href="#" download>‚¨áÔ∏è Download</a>
          <button id="copyBtn" class="btn copy">üìã Copy Link</button>
        </div>
        <div id="fileInfo" class="info"></div>
      </div>
    </div>
  </div>

<script>
(() => {
  const apiBase = "https://test-site-dl.woodmirror.workers.dev/?url=";
  const goBtn = document.getElementById("goBtn");
  const pageUrl = document.getElementById("pageUrl");
  const status = document.getElementById("status");
  const errorBox = document.getElementById("errorBox");
  const videoWrap = document.getElementById("videoWrap");
  const player = document.getElementById("player");
  const titleEl = document.getElementById("title");
  const sourceEl = document.getElementById("source");
  const downloadBtn = document.getElementById("downloadBtn");
  const copyBtn = document.getElementById("copyBtn");
  const fileInfo = document.getElementById("fileInfo");

  function showError(msg){
    errorBox.style.display="block";
    errorBox.textContent=msg;
    status.textContent="";
  }
  function clearError(){
    errorBox.style.display="none";
    errorBox.textContent="";
  }

  async function resolveAndPlay(pageLink){
    clearError();
    videoWrap.style.display="none";
    status.textContent="‚è≥ Fetching video link...";
    try{
      const res=await fetch(apiBase+encodeURIComponent(pageLink));
      const txt=await res.text();
      let data;
      try{ data=JSON.parse(txt);}catch(e){throw new Error("Invalid API JSON.");}
      if(!data.success||!data.video)throw new Error("API returned no video info.");
      const dl=data.video.downloadLink;
      if(!dl)throw new Error("No downloadLink found.");

      titleEl.textContent=data.video.title||"Untitled";
      sourceEl.textContent=data.video.source||"";
      player.src=dl;
      await player.play().catch(()=>{});

      downloadBtn.href=dl;
      copyBtn.onclick=()=>{
        navigator.clipboard.writeText(dl).then(()=>{
          copyBtn.textContent="‚úÖ Copied!";
          setTimeout(()=>copyBtn.textContent="üìã Copy Link",1500);
        });
      };

      fileInfo.textContent=data.video.fileSize?("Size: "+data.video.fileSize):"";
      videoWrap.style.display="flex";
      status.textContent="";
    }catch(err){
      showError("‚ùå "+(err.message||err));
      console.error(err);
    }
  }

  goBtn.addEventListener("click",()=>{
    const url=pageUrl.value.trim();
    if(!url)return showError("Please paste a valid URL.");
    resolveAndPlay(url);
  });
  pageUrl.addEventListener("keydown",e=>{
    if(e.key==="Enter")goBtn.click();
  });
})();
</script>
</body>
</html>
